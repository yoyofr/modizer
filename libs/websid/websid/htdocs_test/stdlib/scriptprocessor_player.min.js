/**
* Generic ScriptProcessor based WebAudio player. 
* <p>AudioBackendAdapterBase: an abstract base class for specific backend (i.e. 'sample data producer') integration.
*
*	version 1.03e+ (with WASM support, cached filename translation & track switch bugfix, "internal filename" 
*				mapping, getVolume, setPanning, AudioContext get/resume, AbstractTicker revisited, bugfix for 
*               duplicate events, improved "play after user gesture" support + doubled sample buffer size)
*
* 	Copyright (C) 2018 Juergen Wothke
*
* Terms of Use: This software is licensed under a CC BY-NC-SA 
* (http://creativecommons.org/licenses/by-nc-sa/4.0/).
*/
var fetchSamples=function(e){window.player.genSamples.bind(window.player)(e)},calcTick=function(e){window.player.tick.bind(window.player)(e)},setGlobalWebAudioCtx=function(){if(void 0===window._gPlayerAudioCtx){var t="Web Audio API is not supported in this browser";try{"AudioContext"in window?window._gPlayerAudioCtx=new AudioContext:"webkitAudioContext"in window?window._gPlayerAudioCtx=new webkitAudioContext:alert(t+e)}catch(e){alert(t+e)}}try{"suspended"===window._gPlayerAudioCtx.state&&"ontouchstart"in window&&window._gPlayerAudioCtx.resume()}catch(e){}};function surrogateCtor(){}function extend(e,t,i){for(var a in surrogateCtor.prototype=e.prototype,t.prototype=new surrogateCtor,(t.prototype.constructor=t).base=e,i)t.prototype[a]=i[a];return t}AbstractTicker=function(){},AbstractTicker.prototype={init:function(e,t){},start:function(){},computeAudioSamplesNotify:function(){},resampleData:function(e,t,i,a){},copyTickerData:function(e,t){},calcTickData:function(e,t){}};var SAMPLES_PER_BUFFER=16384;AudioBackendAdapterBase=function(e,t){this._resampleBuffer=new Float32Array,this._channels=e,this._bytesPerSample=t,this._sampleRate=44100,this._inputSampleRate=44100,this._observer,this._manualSetupComplete=!0},AudioBackendAdapterBase.prototype={computeAudioSamples:function(){this.error("computeAudioSamples")},loadMusicData:function(e,t,i,a,r){this.error("loadMusicData")},evalTrackOptions:function(e){this.error("evalTrackOptions")},updateSongInfo:function(e,t){this.error("updateSongInfo")},getSongInfoMeta:function(){this.error("getSongInfoMeta")},getAudioBuffer:function(){this.error("getAudioBuffer")},getAudioBufferLength:function(){this.error("getAudioBufferLength")},readFloatSample:function(e,t){this.error("readFloatSample")},applyPanning:function(e,t,i){this.error("applyPanning")},getBytesPerSample:function(){return this._bytesPerSample},getChannels:function(){return this._channels},isAdapterReady:function(){return!0},mapInternalFilename:function(e,t,i){return(e||t)+i},mapUrl:function(e){return e},uploadFile:function(e,t){return 0},isManualSetupComplete:function(){return this._manualSetupComplete},teardown:function(){this.error("teardown")},getMaxPlaybackPosition:function(){return 0},getPlaybackPosition:function(){return 0},seekPlaybackPosition:function(e){return-1},getPathAndFilename:function(e){this.error("getPathAndFilename")},registerFileData:function(e,t){this.error("registerFileData")},mapBackendFilename:function(e){return e},mapCacheFileName:function(e){return e},handleBackendSongAttributes:function(e,t){this.error("handleBackendSongAttributes")},mapUri2Fs:function(e){var t=e.replace(/\/\//,"ýý");return t=(t=(t=(t=(t=(t=(t=t.replace(/\?/,"ÿ")).replace(/:/,"þ")).replace(/\*/,"ü")).replace(/"/,"û")).replace(/</,"ù")).replace(/>/,"ø")).replace(/\|/,"÷")},mapFs2Uri:function(e){var t=e.replace(/ýý/,"//");return t=(t=(t=(t=(t=(t=(t=t.replace(/ÿ/,"?")).replace(/þ/,":")).replace(/ü/,"*")).replace(/û/,'"')).replace(/ù/,"<")).replace(/ø/,">")).replace(/÷/,"|")},setObserver:function(e){this._observer=e},notifyAdapterReady:function(){void 0!==this._observer&&this._observer.notify()},error:function(e){alert("fatal error: abstract method '"+e+"' must be defined")},resetSampleRate:function(e,t){0<e&&(this._sampleRate=e),0<t&&(this._inputSampleRate=t);var i=Math.round(SAMPLES_PER_BUFFER*this._sampleRate/this._inputSampleRate)*this.getChannels();i>this._resampleBuffer.length&&(this._resampleBuffer=this.allocResampleBuffer(i))},allocResampleBuffer:function(e){return new Float32Array(e)},getCopiedAudio:function(e,t,i,a){var r;for(r=0;r<t*this._channels;r++)a[r]=i(e,r);return t},resampleTickerData:function(e,t){e.resampleData(this._sampleRate,this._inputSampleRate,t,this)},getResampledAudio:function(e,t){return this.getResampledFloats(e,t,this._sampleRate,this._inputSampleRate)},getResampledFloats:function(e,t,i,a){var r;if(i==a)r=this.getCopiedAudio(e,t,this.readFloatSample.bind(this),this._resampleBuffer);else{var n=(r=Math.round(t*i/a))*this._channels;n>this._resampleBuffer.length&&(this._resampleBuffer=this.allocResampleBuffer(n)),this.resampleToFloat(this._channels,0,e,t,this.readFloatSample.bind(this),this._resampleBuffer,r),2==this._channels&&this.resampleToFloat(this._channels,1,e,t,this.readFloatSample.bind(this),this._resampleBuffer,r)}return r},resampleToFloat:function(e,t,i,a,r,n,s){for(var o,d=0,l=0,c=s-0,h=a-0,u=Math.abs(c-d),f=d<c?1:-1,p=-Math.abs(h-l),_=l<h?1:-1,m=u+p;n[d*e+t]=r(i,l*e+t),!(c<=d&&h<=l);)p<(o=2*m)&&(m+=p,d+=f),o<u&&(m+=u,l+=_)},getResampleBuffer:function(){return this._resampleBuffer}},EmsHEAP16BackendAdapter=function(){var i=function(e,t){i.base.call(this,t,2),this.Module=e,this.Module.adapterCallback=function(){this.doOnAdapterReady(),this.notifyAdapterReady()}.bind(this),window.Math.fround||(window.Math.fround=window.Math.round)};return extend(AudioBackendAdapterBase,i,{doOnAdapterReady:function(){},isAdapterReady:function(){return void 0===this.Module.notReady||!this.Module.notReady},registerEmscriptenFileData:function(e,t){try{this.Module.FS_createPath("/",e[0],!0,!0)}catch(e){}var i;try{i=this.Module.FS_createDataFile(e[0],e[1],t,!0,!0);ScriptNodePlayer.getInstance().trace("registerEmscriptenFileData: ["+e[0]+"]["+e[1]+"] size: "+t.length)}catch(e){}return i},readFloatSample:function(e,t){return this.Module.HEAP16[e+t]/32768},applyPanning:function(e,t,i){var a,r,n,s;for(i=256*i/2,a=0;a<2*t;a+=2){var o=((r=this.Module.HEAP16[e+a])<<8)+(s=((n=this.Module.HEAP16[e+a+1])-r)*i)>>8,d=(n<<8)-s>>8;this.Module.HEAP16[e+a]=o,this.Module.HEAP16[e+a+1]=d}}}),i}(),FileCache=function(){this._binaryFileMap={},this._pendingFileMap={},this._isWaitingForFile=!1},FileCache.prototype={getFileMap:function(){return this._binaryFileMap},getPendingMap:function(){return this._pendingFileMap},setWaitingForFile:function(e){this._isWaitingForFile=e},isWaitingForFile:function(){return this._isWaitingForFile},getFile:function(e){var t;return e in this._binaryFileMap&&(t=this._binaryFileMap[e]),t},setFile:function(e,t){this._binaryFileMap[e]=t,this._isWaitingForFile=!1}};var ScriptNodePlayer=(PlayerImpl=function(e,t,i,a,r,n,s,o,d){void 0===e&&alert("fatal error: backendAdapter not specified"),void 0===r&&alert("fatal error: onPlayerReady not specified"),void 0===n&&alert("fatal error: onTrackReadyToPlay not specified"),void 0===s&&alert("fatal error: onTrackEnd not specified"),2<e.getChannels()&&alert("fatal error: only 1 or 2 output channels supported"),this._backendAdapter=e,this._backendAdapter.setObserver(this),this._basePath=t,this._traceSwitch=!1,this._spectrumEnabled=a,this._songInfo={},this._onTrackReadyToPlay=n,this._onTrackEnd=s,this._onPlayerReady=r,this._onUpdate=o,this._tickerStepWidth=256,void 0!==d&&d.init(SAMPLES_PER_BUFFER,this._tickerStepWidth),this._externalTicker=d,this._currentTick=0,this._sourceBuffer,this._sourceBufferLen,this._numberOfSamplesRendered=0,this._numberOfSamplesToRender=0,this._sourceBufferIdx=0,this._currentPlaytime=0,this._currentTimeout=-1,this.isAutoPlayCripple()||(setGlobalWebAudioCtx(),this._sampleRate=window._gPlayerAudioCtx.sampleRate,this._correctSampleRate=this._sampleRate,this._backendAdapter.resetSampleRate(this._sampleRate,-1)),this._bufferSource,this._gainNode,this._analyzerNode,this._scriptNode,this._freqByteData=0,this._pan=null,window.fileRequestCallback=this.fileRequestCallback.bind(this),window.fileSizeRequestCallback=this.fileSizeRequestCallback.bind(this),window.songUpdateCallback=this.songUpdateCallback.bind(this),this._isPaused=!1,this._isPlayerReady=!1,this._isSongReady=!1,this._initInProgress=!1,this._preLoadReady=!1,window.player=this,window.player.preloadFiles.bind(window.player)(i,function(){this._preLoadReady=!0,this._preLoadReady&&this._backendAdapter.isAdapterReady()&&this._backendAdapter.isManualSetupComplete()&&(this._isPlayerReady=!0,this._onPlayerReady())}.bind(this))},PlayerImpl.prototype={notify:function(){if(void 0!==this.deferredPreload&&this._backendAdapter.isAdapterReady()){var e=this.deferredPreload[0],t=this.deferredPreload[1];delete this.deferredPreload,this.preload(e,e.length,t)}!this._isPlayerReady&&this._preLoadReady&&this._backendAdapter.isAdapterReady()&&this._backendAdapter.isManualSetupComplete()&&(this._isPlayerReady=!0,this._onPlayerReady())},handleBackendEvent:function(){this.notify()},isReady:function(){return this._isPlayerReady},setTraceMode:function(e){this._traceSwitch=e},play:function(){this._isPaused=!1;try{this._bufferSource.start(0)}catch(e){}},pause:function(){this.isWaitingForFile()||this._initInProgress||!this._isSongReady||(this._isPaused=!0)},isPaused:function(){return this._isPaused},resume:function(){this.isWaitingForFile()||this._initInProgress||!this._isSongReady||this.play()},getCurrentTick:function(){var e=Math.ceil(SAMPLES_PER_BUFFER/this._tickerStepWidth)-1;return e=Math.min(e,this._currentTick)},setVolume:function(e){void 0!==this._gainNode&&(this._gainNode.gain.value=e)},getVolume:function(){return void 0!==this._gainNode?this._gainNode.gain.value:-1},setPanning:function(e){this._pan=e},isStereo:function(){return 2==this._backendAdapter.getChannels()},getSongInfo:function(){return this._songInfo},getSongInfoMeta:function(){return this._backendAdapter.getSongInfoMeta()},setPlaybackTimeout:function(e){this._currentPlaytime=0,this._currentTimeout=e<0?-1:e/1e3*this._correctSampleRate},getPlaybackTimeout:function(){return this._currentTimeout<0?-1:Math.round(this._currentTimeout/this._correctSampleRate)},getCurrentPlaytime:function(){return Math.round(this._currentPlaytime/this._correctSampleRate)},getFreqByteData:function(){return this._analyzerNode&&(0===this._freqByteData&&(this._freqByteData=new Uint8Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getByteFrequencyData(this._freqByteData)),this._freqByteData},getMaxPlaybackPosition:function(){return this._backendAdapter.getMaxPlaybackPosition()},getPlaybackPosition:function(){return this._backendAdapter.getPlaybackPosition()},seekPlaybackPosition:function(e){return this._backendAdapter.seekPlaybackPosition(e)},loadMusicFromTmpFile:function(e,a,r,n,t){this.initByUserGesture();var s=e.name;this._fileReadyNotify="";var o=(a.basePath?a.basePath:this._basePath)+s;if(!this.loadMusicDataFromCache(o,a,n)){var d=new FileReader;d.onload=function(){var e=this._backendAdapter.getPathAndFilename(s),t=new Uint8Array(d.result);if(void 0!==this._backendAdapter.registerFileData(e,t)){var i=this._backendAdapter.mapCacheFileName(o);this.getCache().setFile(i,t),this.prepareTrackForPlayback(o,d.result,a),r(s)}else n()}.bind(this),d.onprogress=function(e){t&&t(e.total,e.loaded)}.bind(this),d.readAsArrayBuffer(e)}},isAppleShit:function(){return!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)},isAutoPlayCripple:function(){return window.chrome||this.isAppleShit()},initByUserGesture:function(){if(void 0===this._sampleRate)setGlobalWebAudioCtx(),this._sampleRate=window._gPlayerAudioCtx.sampleRate,this._correctSampleRate=this._sampleRate,this._backendAdapter.resetSampleRate(this._sampleRate,-1);else if("suspended"==window._gPlayerAudioCtx.state)try{window._gPlayerAudioCtx.resume()}catch(e){}if(void 0!==this._bufferSource)try{this._bufferSource.stop(0)}catch(e){}else{var e=window._gPlayerAudioCtx;this.isAppleShit()&&this.iOSHack(e),this._analyzerNode=e.createAnalyser(),this._scriptNode=this.createScriptProcessor(e),this._gainNode=e.createGain(),this._scriptNode.connect(this._gainNode),void 0!==this._externalTicker&&this.createTickerScriptProcessor(e).connect(this._gainNode),this._spectrumEnabled?(this._gainNode.connect(this._analyzerNode),this._analyzerNode.connect(e.destination)):this._gainNode.connect(e.destination),this._bufferSource=e.createBufferSource(),this._bufferSource.start||(this._bufferSource.start=this._bufferSource.noteOn,this._bufferSource.stop=this._bufferSource.noteOff)}},loadMusicFromURL:function(e,t,i,a,r){this.initByUserGesture();var n=this._backendAdapter.mapInternalFilename(t.basePath,this._basePath,e);if(this._fileReadyNotify="",!this.loadMusicDataFromCache(n,t,a)){var s=new XMLHttpRequest;s.open("GET",this._backendAdapter.mapUrl(n),!0),s.responseType="arraybuffer",s.onload=function(e){this.trace("loadMusicFromURL successfully loaded: "+n),this.prepareTrackForPlayback(n,s.response,t)?i(n):this.isWaitingForFile()||a()}.bind(this),s.onprogress=function(e){r&&r(e.total,e.loaded)}.bind(this),s.onreadystatuschange=function(e){4==oReq.readyState&&404==oReq.status&&this.trace("loadMusicFromURL failed to load: "+n)}.bind(this),s.send(null)}},uploadFile:function(a,r,n,s,t){var o=new FileReader;o.onload=function(){var e=this._backendAdapter.getPathAndFilename(a.name),t=new Uint8Array(o.result);if(void 0!==this._backendAdapter.registerFileData(e,t)){var i=this._backendAdapter.uploadFile(a.name,r);0===i?(n(a.name),this._onPlayerReady()):1==i&&n(a.name)}else s()}.bind(this),o.onprogress=function(e){t&&t(e.total,e.loaded)}.bind(this),o.readAsArrayBuffer(a)},prepareTrackForPlayback:function(e,t,i){return this._isPaused=!0,this.lastUsedFilename=e,this.lastUsedData=t,this.lastUsedOptions=i,this._isSongReady=!1,this.setWaitingForFile(!1),this.initIfNeeded(e,t,i)},trace:function(e){this._traceSwitch&&console.log(e)},setWait:function(e){this.setWaitingForFile(e)},getDefaultSampleRate:function(){return this._correctSampleRate},initIfNeeded:function(e,t,i){var a=this.loadMusicData(e,t,i);if(a<0)this._isSongReady=!1,this.setWaitingForFile(!0),this._initInProgress=!1;else{if(0===a)return this.setWaitingForFile(!1),this._isSongReady=!0,this._currentPlaytime=0,this._initInProgress=!1,this.trace("successfully completed init"),0!==this._backendAdapter.evalTrackOptions(i)?(this.trace("error preparing track options"),!1):(this.updateSongInfo(e),this.lastUsedFilename==e&&(this._fileReadyNotify==e?this.play():this._onTrackReadyToPlay(),this._fileReadyNotify=e),!(this._isPaused=!1));this._initInProgress=!1,this.trace("initIfNeeded - fatal error")}return!1},loadMusicDataFromCache:function(e,t,i){this._currentTimeout=-1,this._currentPlaytime=0,this._isPaused=!0;var a=this._backendAdapter.mapCacheFileName(e),r=this.getCache().getFile(a);return void 0!==r&&(this.prepareTrackForPlayback(e,r,t)||this.isWaitingForFile()||i(),!0)},getAudioContext:function(){return this.initByUserGesture(),window._gPlayerAudioCtx},iOSHack:function(e){try{var t=window._gPlayerAudioCtx.createBufferSource();t.start||(t.start=t.noteOn,t.stop=t.noteOff),t.buffer=window._gPlayerAudioCtx.createBuffer(1,1,22050),t.connect(window._gPlayerAudioCtx.destination),t.start(0)}catch(e){}},updateSongInfo:function(e){this._songInfo={},this._backendAdapter.updateSongInfo(e,this._songInfo)},loadMusicData:function(e,t,i){if(this._backendAdapter.teardown(),t){var a=this._backendAdapter.getPathAndFilename(e),r=new Uint8Array(t);this._backendAdapter.registerFileData(a,r);var n=this._backendAdapter.mapCacheFileName(e);this.getCache().setFile(n,r);var s=this._backendAdapter.loadMusicData(this._sampleRate,a[0],a[1],r,i);return 0===s&&this.resetBuffer(),s}},resetBuffer:function(){this._numberOfSamplesRendered=0,this._numberOfSamplesToRender=0,this._sourceBufferIdx=0},resetSampleRate:function(e){this._backendAdapter.resetSampleRate(e,-1),0<e&&(this._sampleRate=e),this.resetBuffer()},createScriptProcessor:function(e){var t=e.createScriptProcessor(SAMPLES_PER_BUFFER,0,this._backendAdapter.getChannels());return t.onaudioprocess=fetchSamples,t},createTickerScriptProcessor:function(e){var t;return(t=e.createScriptProcessor(256,0,1)).onaudioprocess=calcTick,t},fillEmpty:function(e,t,a){var r=e-this._numberOfSamplesRendered;for(i=0;i<r;i++)void(t[i+this._numberOfSamplesRendered]=0)!==a&&(a[i+this._numberOfSamplesRendered]=0);this._numberOfSamplesToRender=0,this._numberOfSamplesRendered=e},fileRequestCallback:function(e){var t=this._backendAdapter.mapBackendFilename(e);return this.preloadFile(t,function(){this.initIfNeeded(this.lastUsedFilename,this.lastUsedData,this.lastUsedOptions)}.bind(this),!1)},fileSizeRequestCallback:function(e){var t=this._backendAdapter.mapBackendFilename(e),i=this._backendAdapter.mapCacheFileName(t);return this.getCache().getFile(i).length},songUpdateCallback:function(e){this._backendAdapter.handleBackendSongAttributes(e,this._songInfo),this._onUpdate&&this._onUpdate()},preload:function(e,t,i){if(0===t)i();else{t--;var a=function(){this.preload(e,t,i)}.bind(this);this.preloadFile(e[t],a,!0)}},preloadFile:function(r,n,e){var s=this._backendAdapter.mapCacheFileName(r),t=this.getCache().getFile(s);if(void 0!==t){var i=0;return 0==t&&(i=1,this.trace("error: preloadFile could not get cached: "+r)),e&&n(),i}if(this._isPaused=!0,this.setWaitingForFile(!0),this._isSongReady=!1,!(s in this.getCache().getPendingMap())){this.getCache().getPendingMap()[s]=1;var o=new XMLHttpRequest;o.open("GET",this._backendAdapter.mapUrl(r),!0),o.responseType="arraybuffer",o.onload=function(e){var t=o.response;if(t){this.trace("preloadFile successfully loaded: "+r);var i=this._backendAdapter.getPathAndFilename(r),a=new Uint8Array(t);this._backendAdapter.registerFileData(i,a),this.getCache().setFile(s,a)}delete this.getCache().getPendingMap()[s]||this.trace("remove file from pending failed: "+s),n()}.bind(this),o.onreadystatuschange=function(e){4==o.readyState&&404==o.status&&(this.trace("preloadFile failed to load: "+r),this.getCache().setFile(s,0))}.bind(this),o.onerror=function(e){this.getCache().setFile(s,0)}.bind(this),o.send(null)}return-1},tick:function(e){this._isPaused||this._currentTick++},genSamples:function(e){var t,i=this.isStereo()&&1<e.outputBuffer.numberOfChannels,a=e.outputBuffer.getChannelData(0);if(i&&(t=e.outputBuffer.getChannelData(1)),!this._isSongReady||this.isWaitingForFile()||this._isPaused){var r;for(r=0;r<a.length;r++)a[r]=0,i&&(t[r]=0)}else{void 0!==this._externalTicker&&this._externalTicker.start();var n=a.length;for(this._numberOfSamplesRendered=0;this._numberOfSamplesRendered<n;){if(0===this._numberOfSamplesToRender){var s;if(0<this._currentTimeout&&this._currentPlaytime>this._currentTimeout?(this.trace("'song end' forced after "+this._currentTimeout/this._correctSampleRate+" secs"),s=1):(s=this._backendAdapter.computeAudioSamples(),void 0!==this._externalTicker&&this._externalTicker.computeAudioSamplesNotify()),0!==s)return this.fillEmpty(n,a,t),s<0?(this._isPaused=!0,this._isSongReady=!1,void this.setWaitingForFile(!0)):this.isWaitingForFile()?void 0:(1<s&&this.trace("playback aborted with an error"),this._isPaused=!0,void(this._onTrackEnd&&this._onTrackEnd()));this._sourceBuffer=this._backendAdapter.getAudioBuffer(),this._sourceBufferLen=this._backendAdapter.getAudioBufferLength(),null!=this._pan&&this._backendAdapter.applyPanning(this._sourceBuffer,this._sourceBufferLen,this._pan+1),this._numberOfSamplesToRender=this._backendAdapter.getResampledAudio(this._sourceBuffer,this._sourceBufferLen),void 0!==this._externalTicker&&this._backendAdapter.resampleTickerData(this._externalTicker,this._sourceBufferLen),this._sourceBufferIdx=0}var o=this._backendAdapter.getResampleBuffer();i?this.copySamplesStereo(o,a,t,n):this.copySamplesMono(o,a,n)}this._currentPlaytime+=n*this._correctSampleRate/this._sampleRate}void 0!==this._externalTicker&&(this._externalTicker.calcTickData(a,t),this._currentTick=0)},copySamplesStereo:function(e,t,i,a){var r;if(this._numberOfSamplesRendered+this._numberOfSamplesToRender>a){var n=a-this._numberOfSamplesRendered;for(r=0;r<n;r++)void 0!==this._externalTicker&&this._externalTicker.copyTickerData(r+this._numberOfSamplesRendered,this._sourceBufferIdx>>1),t[r+this._numberOfSamplesRendered]=e[this._sourceBufferIdx++],i[r+this._numberOfSamplesRendered]=e[this._sourceBufferIdx++];this._numberOfSamplesToRender-=n,this._numberOfSamplesRendered=a}else{for(r=0;r<this._numberOfSamplesToRender;r++)void 0!==this._externalTicker&&this._externalTicker.copyTickerData(r+this._numberOfSamplesRendered,this._sourceBufferIdx>>1),t[r+this._numberOfSamplesRendered]=e[this._sourceBufferIdx++],i[r+this._numberOfSamplesRendered]=e[this._sourceBufferIdx++];this._numberOfSamplesRendered+=this._numberOfSamplesToRender,this._numberOfSamplesToRender=0}},copySamplesMono:function(e,t,i){var a;if(this._numberOfSamplesRendered+this._numberOfSamplesToRender>i){var r=i-this._numberOfSamplesRendered;for(a=0;a<r;a++)void 0!==this._externalTicker&&this._externalTicker.copyTickerData(a+this._numberOfSamplesRendered,this._sourceBufferIdx),t[a+this._numberOfSamplesRendered]=e[this._sourceBufferIdx++];this._numberOfSamplesToRender-=r,this._numberOfSamplesRendered=i}else{for(a=0;a<this._numberOfSamplesToRender;a++)void 0!==this._externalTicker&&this._externalTicker.copyTickerData(a+this._numberOfSamplesRendered,this._sourceBufferIdx),t[a+this._numberOfSamplesRendered]=e[this._sourceBufferIdx++];this._numberOfSamplesRendered+=this._numberOfSamplesToRender,this._numberOfSamplesToRender=0}},preloadFiles:function(e,t){this._isPaused=!0,this._backendAdapter.isAdapterReady()?this.preload(e,e.length,t):this.deferredPreload=[e,t]},setWaitingForFile:function(e){this.getCache().setWaitingForFile(e)},isWaitingForFile:function(){return this.getCache().isWaitingForFile()},getCache:function(){return void 0===window._fileCache&&(window._fileCache=new FileCache),window._fileCache}},{createInstance:function(e,t,i,a,r,n,s,o,d){var l=!1;if(void 0!==window.player){var c=window.player;if(c._isPaused=!0,void 0!==c._bufferSource)try{c._bufferSource.stop(0)}catch(e){}c._scriptNode&&c._scriptNode.disconnect(0),c._analyzerNode&&c._analyzerNode.disconnect(0),c._gainNode&&c._gainNode.disconnect(0),l=c._traceSwitch}new PlayerImpl(e,t,i,a,r,n,s,o,d)._traceSwitch=l},getInstance:function(){return void 0===window.player&&alert("fatal error: window.player not defined"),window.player}});